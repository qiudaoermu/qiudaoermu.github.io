---
  layout: post
  tilte: "ğŸ¥–-npm-bin-å…¨å±€å‘½ä»¤åŸç†.md"
  date: 2021-10-21-
  tags: 
    - å¼€å‘æ—¥å¸¸

---



## å‰è¨€
ç”¨è¿‡æ„å»ºå·¥å…·çš„äº²ä»¬çŸ¥é“ï¼Œé€šå¸¸é€šè¿‡å…¨å±€å®‰è£…ä¸€ä¸ª xxx-cli çš„ npm åŒ…ï¼Œå°±èƒ½åœ¨å‘½ä»¤è¡Œç”¨å‘½ä»¤è¿›è¡Œæ„å»ºã€‚é‚£ä¹ˆè¿™ä¸ª npm åŒ…å¦‚ä½•å˜æˆä¸€ä¸ªå¯æ‰§è¡Œçš„å‘½ä»¤å‘¢ï¼Ÿ
### npm cli å¼€å‘æ­¥éª¤
#### 1. ä½¿ç”¨ npm init åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç›®å½• my-cliã€‚
#### 2. åœ¨ package.json ä¸­æ·»åŠ æˆ–è€…ç¼–è¾‘ bin å­—æ®µï¼š
```
{
  "name": "my-cli",
  ...,
  "bin": {
    "command-name": "jsfile" // path of jsfile relative to package.json
  },
  ...
}
```

commandName å°±æ˜¯å‘½ä»¤çš„åå­—ï¼Œjsfile å°±æ˜¯å½“ç”¨æˆ·é”®å…¥å‘½ä»¤æ—¶çš„å¤„ç†ç¨‹åºã€‚

#### 3.ä»£ç å¼€å‘ã€‚å¿…é¡»åœ¨ jsfile æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå†™è¿™è¡Œå‘½ä»¤ #!/usr/bin/env nodeï¼Œè­¬å¦‚ï¼š
```js

#!/usr/bin/env node
const program = require('commander');
const packageJson = require('../package');

let defaultJsProcessors = [ 'react' ];
let defaultStyleProcessors = [ 'sasslike' ];
let defaultWebpackVersion = '4';

function parseListArgv( val ) {
  if ( val ) {
    return val.split( ',' );
  } else {
    return [];
  }
}

program
  .version( packageJson.version, '-v, --version' )
  .option( '-u, --use-version <version-number>', 'Webpack version' )
  .option( '-j, --js-processors <processors>', 'Specify javascript processors', parseListArgv )
  .option( '-s, --style-processors <processors>', 'Specify style(css,image,fonts) processors', parseListArgv )
  .option( '--no-install', 'Do not install devDependncies package' )
  .parse( process.argv );


let jsProcessors = program.jsProcessors || defaultJsProcessors;
let styleProcessors = program.styleProcessors || defaultStyleProcessors;
let webpackVersion = program.useVersion || defaultWebpackVersion;

if ( webpackVersion=='4' ) {
  // code
} else {
  // code
}

```
### npm cli è¿è¡ŒåŸç†
#### Unix-like å¹³å°

1.å½“å…¨å±€å®‰è£… npm åŒ…çš„æ—¶å€™ï¼Œnpm ä¼šæŠŠ package.json ä¸­ bin é…ç½®çš„ command-name æ·»åŠ åˆ°ç³»ç»Ÿ *$PATH*ä¸­å»ã€‚

æ‹¿ macOS ä¸¾ä¾‹ï¼Œnpm ä¼šåœ¨ /usr/local/bin ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ command-name ä¸ºåå­—çš„è½¯é“¾æ¥ï¼ŒæŒ‡å‘å…¨å±€å®‰è£…ä¸‹æ¥çš„ 
/usr/local/lib/node_modules/my-cli åŒ…ä¸‹é¢çš„ jsï¼šjsfileã€‚ï¼ˆ/usr/local/bin æ˜¯åœ¨ $PATH ä¸­çš„ï¼‰

**å¦‚æœå…¨å±€å®‰è£…rollupï¼š**

**/usr/local/bin ç›®å½•**
![image.png](https://upload-images.jianshu.io/upload_images/15312191-c9a91b9120152db2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**/usr/local/lib/node_modules ç›®å½•**
![image.png](https://upload-images.jianshu.io/upload_images/15312191-c9fee4fa8f696a48.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


2.åœ¨å‘½ä»¤è¡Œé”®å…¥ command-name ç›¸å½“äºæ‰§è¡Œäº†æ–‡æœ¬æ–‡ä»¶ jsfileã€‚
3.åœ¨æ‰§è¡Œçš„æ—¶å€™ç¢°åˆ°ç¬¬ä¸€è¡Œ #!/usr/bin/env nodeï¼Œè¿™æ˜¯ä¸€ä¸ª shebang è¡Œã€‚è¿™è¡Œå‘Šè¯‰ç³»ç»Ÿä½¿ç”¨ node å»æ‰§è¡Œå½“å‰æ–‡ä»¶ã€‚ï¼ˆshebang åªæœ‰åœ¨Unix-likeå¹³å°æ‰æœ‰ï¼‰
4.æ‰§è¡Œ js æ–‡ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼š#! å¹¶ä¸æ˜¯ä¸€ä¸ªç¬¦åˆ js è¯­æ³•çš„è¯­å¥ï¼Œç†è®ºä¸Šç›´æ¥æ‰§è¡Œæ˜¯ä¼šæœ‰ syntax error çš„ã€‚ä½†æ˜¯ node å¯¹ shebang è¡Œåšäº†ä¾‹å¤–å¤„ç†ï¼Œæ‰€ä»¥ç”¨ node æ‰§è¡Œå¸¦ shebang è¡Œçš„ js æ–‡ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

#### Windows å¹³å°
1.å…¨å±€å®‰è£…ä¼šæŠŠåŒ…å®‰è£…åˆ° C:\Users\username\AppData\Roaming\npm\node_modulesä¸‹é¢ï¼Œç„¶ååœ¨ C:\Users\username\AppData\Roaming\npm ç”Ÿæˆä¸€ä¸ªä»¥ command-name ä¸ºåå­—çš„ cmd æ–‡ä»¶ï¼šcommand-name.cmdã€‚ï¼ˆC:\Users\username\AppData\Roaming\npm åœ¨å®‰è£… npm æ—¶è¢«åŠ å…¥åˆ° %PATH% ä¸­ï¼‰

2.åœ¨ Windows å¹³å°è¿è¡Œ cmd æ–‡ä»¶æ˜¯ä¸éœ€è¦åç¼€åçš„ï¼Œæ‰€ä»¥å½“åœ¨å‘½ä»¤è¡Œé”®å…¥ command-name ç›¸å½“äºæ‰§è¡Œ C:\Users\username\AppData\Roaming\npm\command-name.cmdã€‚

3.ä¸ºä»€ä¹ˆæœ‰è¿™ä¸ª cmd æ–‡ä»¶ï¼Œå› ä¸º windows å¹³å°æ²¡æœ‰ shebangï¼Œé‚£ä¹ˆ command-name.cmd å°±æ¨¡æ‹Ÿäº† #!/usr/bin/env node çš„åŠŸèƒ½ï¼Œè°ƒç”¨ C:\Users\username\AppData\Roaming\npm\node_modules\my-cli\ jsfile
